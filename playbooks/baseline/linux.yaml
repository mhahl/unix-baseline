- name: Deploy baseline systemd templates
  ansible.builtin.template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: "{{ item.mode | default('0644') }}"
  loop: "{{ baseline_systemd_files }}"
  vars:
    baseline_systemd_files:
      - src: baseline/baseline.service.j2
        dest: /etc/systemd/system/baseline.service
      - src: baseline/baseline.timer.j2
        dest: /etc/systemd/system/baseline.timer

- name: Enable and start baseline timer
  ansible.builtin.systemd:
    daemon_reload: true
    name: baseline.timer
    enabled: true
    state: started

- name: Install required collections globally
  become: true
  ansible.builtin.command: >-
    ansible-galaxy collection install community.general ansible.posix -p /usr/share/ansible/collections
  args:
    creates: /usr/share/ansible/collections/ansible_collections/ansible/posix
  changed_when: false