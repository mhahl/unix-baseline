# Automatically include any custom .conf files from this directory (RHEL/Fedora recommended way)
Include /etc/ssh/sshd_config.d/*.conf

# Port sshd listens on (default 22 – changing to non-standard helps reduce noise/scans)
Port 22

# Which address families to listen on (any = both IPv4 and IPv6)
AddressFamily any

# Addresses to listen on (0.0.0.0 = all IPv4 interfaces, :: = all IPv6 interfaces)
ListenAddress 0.0.0.0
ListenAddress ::

# Host private keys that sshd will present to clients (order = preference order)
HostKey /etc/ssh/ssh_host_ed25519_key           # Modern, very secure, fast (preferred)
HostKey /etc/ssh/ssh_host_rsa_key               # For compatibility (should be ≥3072 bits)

# Key exchange algorithms (modern + post-quantum resistant options first)
KexAlgorithms sntrup761x25519-sha512@openssh.com,curve25519-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512

# Encryption ciphers (strong authenticated encryption preferred)
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr

# Message authentication codes (integrity protection – etm = encrypt-then-mac is best)
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com

# Public key algorithms accepted for host keys and user authentication
HostKeyAlgorithms ssh-ed25519-cert-v01@openssh.com,ssh-ed25519,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-256

# Public key types accepted for client authentication
PubkeyAcceptedAlgorithms +ssh-ed25519-cert-v01@openssh.com,ssh-ed25519,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-256

# Minimum RSA key size allowed (prevents weak legacy keys)
RequiredRSASize 3072

# Where to send log messages (AUTH = traditional secure/auth facility)
SyslogFacility AUTH

# How detailed logging should be (VERBOSE shows successful & failed auth + which method)
LogLevel VERBOSE

# How long a client has to complete authentication before being disconnected
LoginGraceTime 45

# Completely disable root login over SSH (very strong security recommendation)
PermitRootLogin no

# Check file/directory permissions of user's home, .ssh/, authorized_keys etc.
StrictModes yes

# Maximum authentication attempts allowed per connection (helps against brute-force)
MaxAuthTries 4

# Maximum concurrent sessions per connection (limits multiplexing abuse)
MaxSessions 8

# Allow public key authentication (highly recommended – main secure method)
PubkeyAuthentication yes

# Allow password authentication
PasswordAuthentication yes

# Allow keyboard-interactive authentication (needed for PAM prompts on RHEL/Fedora)
KbdInteractiveAuthentication yes

# Use PAM for authentication, account, session and password management (required on RHEL/Fedora)
UsePAM yes

# Never allow empty/blank passwords (even if PAM would technically allow it)
PermitEmptyPasswords no

# Restrict SSH access to only users who are members of this group (primary or supplementary)
# This is the key line that enforces "only grp-sigaint-users members may login"
AllowGroups grp-sigaint-users

# Disable agent forwarding (prevents keys being forwarded to potentially compromised hosts)
AllowAgentForwarding no

# Disable all TCP forwarding/tunneling (very restrictive – good security posture)
AllowTcpForwarding local

# Prevent clients from binding forwarded ports to non-loopback addresses
GatewayPorts no
PermitOpen 127.0.0.1:*

# Disable X11 forwarding (almost never needed anymore + security risk)
X11Forwarding no

# Allow interactive shell/TTY (usually yes unless you're only doing port forwarding)
PermitTTY yes

# Don't print /etc/motd when logging in (many prefer cleaner login)
PrintMotd no

# Show last login time (useful for detecting unauthorized access)
PrintLastLog yes

# Send keepalive messages to detect dead connections
TCPKeepAlive yes

# Send client alive messages every 300 seconds (5 min)
ClientAliveInterval 300

# Disconnect after 0 missed keepalive responses → 5 min idle timeout
ClientAliveCountMax 0

# Don't do DNS lookups on client IP (speeds up connection + avoids DNS poisoning)
UseDNS no

# Rate-limit new unauthenticated connections (10 unauth at once, 30% more allowed, max 60)
MaxStartups 10:30:60

# Don't allow environment variables to be set by client
PermitUserEnvironment no

# Disable tun/tap device forwarding (almost never needed)
PermitTunnel no

# Don't show any pre-login banner
Banner none

# SFTP subsystem – path to internal-sftp or sftp-server binary
Subsystem sftp /usr/libexec/openssh/sftp-server

PerSourceMaxStartups 3

# PerSourcePenalties (OpenSSH 9.8+): built-in IP penalty for bad behavior
# authfail:10s  ← each failed auth attempt adds 10 seconds penalty to the IP
# Penalties accumulate → if total > min (default 15s), connection refused
# Other penalties kept at sane defaults; adjust as needed
#PerSourcePenalties authfail:5s crash:90s noauth:1s grace-exceeded:20s refuseconnection:10s


