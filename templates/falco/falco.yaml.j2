# Example falco.yaml.j2 template for Ansible
# Minimal, functional configuration for Falco (modern_eBPF driver)
# Uses default rules via falcoctl

json_output: true
json_include_output_property: true
json_include_tags_property: true

log_stderr: true
log_syslog: true
log_level: info

rules_files:
  - /etc/falco/falco_rules.yaml
  - /etc/falco/falco_rules.local.yaml   # For custom rules/overrides
  - /etc/falco/rules.d                  # Directory for additional custom rules

watch_config_files: true

# modern_eBPF specific tuning
engine:
  kind: modern_ebpf

modern_ebpf:
  # Buffer size preset (index): higher = larger buffers, fewer drops on busy systems
  # Default is around 4 (8MB per buffer). Try 5-7 for high-load; monitor drops
  buf_size_preset: 6
  # Optional: CPUs per buffer (default 2; higher = fewer but larger buffers)
  # cpus_for_each_buffer: 4

# Output configuration
priority: debug
output_timeout: 2000

# Metrics for Prometheus (enable if desired)
webserver:
  enabled: true
  listen_port: 8765

metrics:
  enabled: true
  prometheus_metrics_enabled: true