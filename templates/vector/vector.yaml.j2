sources:
  journald:
    type: journald
    current_boot_only: true
    batch_size: 100

  varlog_files:
    type: file
    include:
      - /var/log/auth.log
      - /var/log/secure
      - /var/log/messages
      - /var/log/syslog
      - /var/log/kern.log
      - /var/log/boot.log
      - /var/log/dmesg
      - /var/log/faillog
      - /var/log/cron
      - /var/log/mail.log
      - /var/log/maillog
      - /var/log/yum.log
      - /var/log/dnf.log
      - /var/log/httpd/*.log
      - /var/log/insights-client.log
      - /var/log/*.log

      # For FreeIPA Dirsrv
      - /var/log/dirsrv/*/access
      - /var/log/dirsrv/*/errors
      - /var/log/dirsrv/*/errors

      # For tlog-rec
      - /var/log/tlog/*.json
    exclude:
      - /var/log/journal/**/*
      - /var/log/lastlog
      - /var/log/btmp
      - /var/log/wtmp
      - /var/log/*.gz
      - /var/log/*.1
      - /var/log/*.old
    file_key: file
    ignore_older_secs: 1209600
    fingerprinting:
      strategy: device_and_inode

transforms:
  enrich_source:
    type: remap
    inputs:
      - journald
      - varlog_files
    source: |
      .source_type = if exists(.file) { "varlog_file" } else { "journald" }
      if exists(.file) {
        .logfile = parse_regex!(.file, r'.*/(?P<basename>[^/]+)$').basename
      }

sinks:
  elasticsearch:
    type: elasticsearch
    inputs:
      - enrich_source
    endpoints:
      - http://syslog.v4.ts.sigaint.au:9428/insert/elasticsearch/
    api_version: v8
    compression: gzip
    healthcheck:
      enabled: false
    query:
      _msg_field: message
      _time_field: timestamp
      _stream_fields: host,source_type,container_name